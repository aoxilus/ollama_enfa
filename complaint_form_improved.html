<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complaint Form - Improved</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .error { color: red; font-size: 14px; margin-top: 5px; }
        .success { color: green; font-size: 14px; margin-top: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Complaint Form - Improved</h1>
    
    <form id="complaintForm" novalidate>
        <div class="form-group">
            <label for="name">Name: *</label>
            <input type="text" id="name" name="name" required 
                   aria-describedby="name-error" 
                   pattern="[A-Za-z\s]{2,50}"
                   title="Name must be 2-50 characters, letters and spaces only">
            <div id="name-error" class="error" role="alert"></div>
        </div>
        
        <div class="form-group">
            <label for="email">Email: *</label>
            <input type="email" id="email" name="email" required 
                   aria-describedby="email-error">
            <div id="email-error" class="error" role="alert"></div>
        </div>
        
        <div class="form-group">
            <label for="complaint">Complaint: *</label>
            <textarea id="complaint" name="complaint" rows="4" required 
                      aria-describedby="complaint-error"
                      minlength="10" maxlength="1000"
                      title="Complaint must be 10-1000 characters"></textarea>
            <div id="complaint-error" class="error" role="alert"></div>
        </div>
        
        <button type="submit" id="submitBtn">Submit Complaint</button>
    </form>

    <div id="result"></div>

    <script>
        // Input validation function
        function validateInput(input, errorElement) {
            const value = input.value.trim();
            let isValid = true;
            let errorMessage = '';

            // Remove existing error styling
            input.classList.remove('error-input');
            errorElement.textContent = '';

            // Check if required field is empty
            if (input.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'This field is required.';
            }

            // Email validation
            if (input.type === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid email address.';
                }
            }

            // Name validation
            if (input.id === 'name' && value) {
                const nameRegex = /^[A-Za-z\s]{2,50}$/;
                if (!nameRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Name must be 2-50 characters, letters and spaces only.';
                }
            }

            // Complaint validation
            if (input.id === 'complaint' && value) {
                if (value.length < 10) {
                    isValid = false;
                    errorMessage = 'Complaint must be at least 10 characters long.';
                }
                if (value.length > 1000) {
                    isValid = false;
                    errorMessage = 'Complaint must be less than 1000 characters.';
                }
            }

            // Display error if invalid
            if (!isValid) {
                input.classList.add('error-input');
                errorElement.textContent = errorMessage;
            }

            return isValid;
        }

        // Real-time validation
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            const errorElement = document.getElementById(input.id + '-error');
            
            input.addEventListener('blur', () => {
                validateInput(input, errorElement);
            });
            
            input.addEventListener('input', () => {
                if (input.classList.contains('error-input')) {
                    validateInput(input, errorElement);
                }
            });
        });

        // Form submission
        document.getElementById('complaintForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const result = document.getElementById('result');
            
            // Validate all inputs
            let isFormValid = true;
            inputs.forEach(input => {
                const errorElement = document.getElementById(input.id + '-error');
                if (!validateInput(input, errorElement)) {
                    isFormValid = false;
                }
            });

            if (!isFormValid) {
                result.innerHTML = '<div class="error">Please fix the errors above before submitting.</div>';
                return;
            }

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Simulate server submission
            setTimeout(() => {
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const complaint = document.getElementById('complaint').value.trim();
                
                // Sanitize output to prevent XSS
                const sanitize = (str) => {
                    const div = document.createElement('div');
                    div.textContent = str;
                    return div.innerHTML;
                };
                
                result.innerHTML = `
                    <div class="success">
                        <h3>âœ… Complaint Submitted Successfully!</h3>
                        <p><strong>Name:</strong> ${sanitize(name)}</p>
                        <p><strong>Email:</strong> ${sanitize(email)}</p>
                        <p><strong>Complaint:</strong> ${sanitize(complaint)}</p>
                        <p><em>Thank you for your feedback. We will review your complaint and respond within 24 hours.</em></p>
                    </div>
                `;
                
                // Clear form
                document.getElementById('complaintForm').reset();
                
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Complaint';
                
                // Focus on first input
                document.getElementById('name').focus();
            }, 1000);
        });
    </script>
</body>
</html>